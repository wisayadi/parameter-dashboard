<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resistor Color Band Scanner PRO AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>

<style>
body{
  margin:0;
  background:#020617;
  font-family:Segoe UI,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:white;
}
.app{
  width:94%;
  max-width:420px;
  background:#0f172a;
  padding:14px;
  border-radius:18px;
}
video{
  width:100%;
  border-radius:14px;
  border:2px solid #00ffcc;
}
.value{
  margin-top:12px;
  font-size:26px;
  color:#9aff00;
  text-align:center;
  font-weight:bold;
}
button{
  width:100%;
  margin-top:12px;
  padding:12px;
  border:none;
  border-radius:12px;
  background:linear-gradient(90deg,#00ffcc,#00bfa5);
  font-weight:bold;
}
</style>
</head>

<body>
<div class="app">
  <h3 style="text-align:center;color:#38bdf8">ðŸ“· Resistor Scanner AI</h3>
  <video id="video" autoplay playsinline muted></video>
  <canvas id="canvas" hidden></canvas>
  <div class="value" id="value">â€”</div>
  <button id="scanBtn">SCAN RESISTOR</button>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const valueEl = document.getElementById("value");
const scanBtn = document.getElementById("scanBtn");

navigator.mediaDevices.getUserMedia({
  video:{ facingMode:"environment" }
}).then(s => video.srcObject = s);

const COLORS = [
  {name:"Hitam", hsv:[0,0,0], val:0},
  {name:"Coklat", hsv:[20,60,60], val:1},
  {name:"Merah", hsv:[0,80,80], val:2},
  {name:"Oranye", hsv:[20,90,90], val:3},
  {name:"Kuning", hsv:[30,90,90], val:4},
  {name:"Hijau", hsv:[60,80,80], val:5},
  {name:"Biru", hsv:[110,80,80], val:6},
  {name:"Ungu", hsv:[150,70,70], val:7}
];

function rgb2hsv(r,g,b){
  r/=255; g/=255; b/=255;
  let max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,v=max;
  let d=max-min;
  s=max===0?0:d/max;
  if(max===min) h=0;
  else{
    switch(max){
      case r: h=(g-b)/d+(g<b?6:0); break;
      case g: h=(b-r)/d+2; break;
      case b: h=(r-g)/d+4; break;
    }
    h*=60;
  }
  return [h,s*100,v*100];
}

function nearestColor(hsv){
  let best=COLORS[0], min=1e9;
  for(let c of COLORS){
    let d=Math.hypot(hsv[0]-c.hsv[0], hsv[1]-c.hsv[1]);
    if(d<min){min=d; best=c;}
  }
  return best;
}

scanBtn.onclick = ()=>{
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video,0,0);

  const img = ctx.getImageData(0,0,canvas.width,canvas.height);

  // Area aman resistor
  const rx = canvas.width*0.25;
  const ry = canvas.height*0.45;
  const rw = canvas.width*0.5;
  const rh = canvas.height*0.12;

  let bands=[];

  for(let i=0;i<4;i++){
    let x = rx + i*(rw/4);
    let r=0,g=0,b=0,c=0;

    for(let y=ry;y<ry+rh;y+=2){
      for(let xx=x;xx<x+rw/4;xx+=2){
        let id=(y*img.width+xx)*4;
        let rr=img.data[id], gg=img.data[id+1], bb=img.data[id+2];
        if(rr+gg+bb<100||rr+gg+bb>650) continue;
        r+=rr; g+=gg; b+=bb; c++;
      }
    }
    if(c){
      let hsv=rgb2hsv(r/c,g/c,b/c);
      bands.push(hsv);
    }
  }

  // buang toleransi (emas)
  if(bands[bands.length-1][1]<20){
    bands.pop();
  }

  let d0=nearestColor(bands[0]).val;
  let d1=nearestColor(bands[1]).val;
  let mul=nearestColor(bands[2]).val;

  let value=(d0*10+d1)*Math.pow(10,mul);

  valueEl.innerText =
    value>=1e6 ? (value/1e6).toFixed(1)+" MÎ©" :
    value>=1e3 ? (value/1e3).toFixed(1)+" kÎ©" :
    value+" Î©";
};
  </script>
</body>
</html>
