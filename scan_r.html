<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resistor Color Band Scanner PRO AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>

<style>
body{
  margin:0;
  background:#020617;
  font-family:Segoe UI,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:white;
}
.app{
  width:94%;
  max-width:420px;
  background:#0f172a;
  padding:14px;
  border-radius:18px;
}
video{
  width:100%;
  border-radius:14px;
  border:2px solid #00ffcc;
}
.value{
  margin-top:12px;
  font-size:26px;
  color:#9aff00;
  text-align:center;
  font-weight:bold;
}
button{
  width:100%;
  margin-top:12px;
  padding:12px;
  border:none;
  border-radius:12px;
  background:linear-gradient(90deg,#00ffcc,#00bfa5);
  font-weight:bold;
}
</style>
</head>

<body>
<div class="app">
  <h3 style="text-align:center;color:#38bdf8">ðŸ“· Resistor Scanner AI</h3>
  <video id="video" autoplay playsinline muted></video>
  <canvas id="canvas" hidden></canvas>
  <div class="value" id="value">â€”</div>
  <button id="scanBtn">SCAN RESISTOR</button>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const valueEl = document.getElementById("value");
const scanBtn = document.getElementById("scanBtn");

navigator.mediaDevices.getUserMedia({
  video:{ facingMode:"environment" }
}).then(s => video.srcObject = s);

// === DATABASE WARNA RESISTOR ===
const bands = [
  {name:"Hitam", rgb:[0,0,0], value:0},
  {name:"Coklat", rgb:[120,70,20], value:1},
  {name:"Merah", rgb:[200,40,40], value:2},
  {name:"Oranye", rgb:[255,130,0], value:3},
  {name:"Kuning", rgb:[255,220,0], value:4},
  {name:"Hijau", rgb:[0,160,80], value:5},
  {name:"Biru", rgb:[40,80,200], value:6},
  {name:"Ungu", rgb:[140,60,160], value:7}
];

function dist(a,b){
  return Math.sqrt(
    (a[0]-b[0])**2 +
    (a[1]-b[1])**2 +
    (a[2]-b[2])**2
  );
}

function detectColor(r,g,b){
  let min = 999999;
  let sel = bands[0];
  for(let c of bands){
    let d = dist([r,g,b], c.rgb);
    if(d < min){ min = d; sel = c; }
  }
  return sel;
}

scanBtn.onclick = ()=>{
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video,0,0);

  // strip tengah
  const y = canvas.height * 0.45;
  const h = canvas.height * 0.12;
  const x = canvas.width * 0.2;
  const w = canvas.width * 0.6;

  const img = ctx.getImageData(x,y,w,h);
  const bandW = w/3;
  let digits = [];

  for(let i=0;i<3;i++){
    let r=0,g=0,b=0,cnt=0;
    for(let px=i*bandW; px<(i+1)*bandW; px+=4){
      let idx = (Math.floor(px) * 4);
      r += img.data[idx];
      g += img.data[idx+1];
      b += img.data[idx+2];
      cnt++;
    }
    r/=cnt; g/=cnt; b/=cnt;
    let c = detectColor(r,g,b);
    digits.push(c.value);
  }

  const val = (digits[0]*10 + digits[1]) * Math.pow(10,digits[2]);
  valueEl.innerText =
    val>=1e6 ? val/1e6+" MÎ©" :
    val>=1e3 ? val/1e3+" kÎ©" :
    val+" Î©";
};
  </script>
</body>
</html>
