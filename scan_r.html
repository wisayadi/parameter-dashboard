<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Resistor Color Band Scanner PRO AI</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>

<style>
body{
  margin:0;
  background:#020617;
  font-family:Segoe UI,sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  color:white;
}
.app{
  width:94%;
  max-width:420px;
  background:#0f172a;
  padding:14px;
  border-radius:18px;
}
video{
  width:100%;
  border-radius:14px;
  border:2px solid #00ffcc;
}
.value{
  margin-top:12px;
  font-size:26px;
  color:#9aff00;
  text-align:center;
  font-weight:bold;
}
button{
  width:100%;
  margin-top:12px;
  padding:12px;
  border:none;
  border-radius:12px;
  background:linear-gradient(90deg,#00ffcc,#00bfa5);
  font-weight:bold;
}
</style>
</head>

<body>
<div class="app">
  <h3 style="text-align:center;color:#38bdf8">ðŸ“· Resistor Scanner AI</h3>
  <video id="video" autoplay playsinline muted></video>
  <canvas id="canvas" hidden></canvas>
  <div class="value" id="value">â€”</div>
  <button id="scanBtn">SCAN RESISTOR</button>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const valueEl = document.getElementById("value");
const scanBtn = document.getElementById("scanBtn");

navigator.mediaDevices.getUserMedia({
  video:{ facingMode:"environment" }
}).then(s => video.srcObject = s);

// === DATABASE WARNA (DISENGAJA DIPISAH JAUH) ===
const bands = [
  {name:"Hitam", rgb:[20,20,20], value:0},
  {name:"Coklat", rgb:[120,70,30], value:1},
  {name:"Merah", rgb:[200,50,50], value:2},
  {name:"Oranye", rgb:[240,130,30], value:3},
  {name:"Kuning", rgb:[240,220,50], value:4},
  {name:"Hijau", rgb:[50,160,80], value:5},
  {name:"Biru", rgb:[60,90,200], value:6},
  {name:"Ungu", rgb:[140,80,180], value:7}
];

function dist(a,b){
  return Math.hypot(a[0]-b[0], a[1]-b[1], a[2]-b[2]);
}

function detectColor(rgb){
  let best = bands[0], min = 1e9;
  for(let c of bands){
    let d = dist(rgb, c.rgb);
    if(d < min){ min = d; best = c; }
  }
  return best;
}

function getAvgRGB(img, x0, y0, w, h){
  let r=0,g=0,b=0,c=0;
  for(let y=y0; y<y0+h; y+=2){
    for(let x=x0; x<x0+w; x+=2){
      let i = (y*img.width + x)*4;
      let rr = img.data[i];
      let gg = img.data[i+1];
      let bb = img.data[i+2];

      // buang terlalu gelap / terang (background)
      if(rr+gg+bb < 80 || rr+gg+bb > 700) continue;

      r+=rr; g+=gg; b+=bb; c++;
    }
  }
  return c ? [r/c,g/c,b/c] : [0,0,0];
}

scanBtn.onclick = ()=>{
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  const ctx = canvas.getContext("2d");
  ctx.drawImage(video,0,0);

  const img = ctx.getImageData(0,0,canvas.width,canvas.height);

  // AREA RESISTOR (AMAN)
  const rx = canvas.width * 0.25;
  const ry = canvas.height * 0.45;
  const rw = canvas.width * 0.5;
  const rh = canvas.height * 0.12;

  let digits = [];

  for(let i=0;i<3;i++){
    let bx = rx + i*(rw/3);
    let rgb = getAvgRGB(img, bx, ry, rw/3, rh);
    let band = detectColor(rgb);
    digits.push(band.value);
  }

  const val = (digits[0]*10 + digits[1]) * Math.pow(10, digits[2]);

  valueEl.innerText =
    val>=1e6 ? (val/1e6).toFixed(1)+" MÎ©" :
    val>=1e3 ? (val/1e3).toFixed(1)+" kÎ©" :
    val+" Î©";
};
  </script>
</body>
</html>
