<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>ðŸŒ‹ Monitor Gempa BMKG</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(180deg, #f5fff5, #f0faff);
      margin: 0; padding: 0;
      display: flex; flex-direction: column; align-items: center;
      overflow-x: hidden;
    }

   h2 {
    margin-top: 10px;
    color: purple;
    text-align: center;
    font-size: 12px;
  }  

    #scrollGempa {
      margin-top: 20px;
      padding: 15px 25px;
      font-size: 1rem;
      font-weight: 500;
      border-radius: 20px;
      background: linear-gradient(90deg, #fff, #f5f5f5);
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      transition: opacity 0.8s ease;
      text-align: center;
      width: 90%;
      max-width: 900px;
      animation: pulseGradient 6s infinite;
    }

    .warna-abu-emas { color: #777; }
    .warna-orange { color: #d87b00; font-weight: 600; }
    .warna-merah-maron { color: #a60000; font-weight: 700; }

    #map {
      height: 400px;
      width: 90%;
      max-width: 900px;
      border-radius: 20px;
      margin: 25px 0;
      box-shadow: 0 4px 14px rgba(0,0,0,0.15);
      transition: transform 0.2s;
    }

    /* ðŸ”µ Efek gradient berdenyut lembut */
    @keyframes pulseGradient {
      0% { background: linear-gradient(90deg, #fffde8, #f0fff0); }
      50% { background: linear-gradient(90deg, #e0f7ff, #fff5e0); }
      100% { background: linear-gradient(90deg, #fffde8, #f0fff0); }
    }

    /* ðŸ’¥ Animasi getar pelan */
    @keyframes shake {
      0%, 100% { transform: translate(0, 0); }
      20% { transform: translate(-3px, 2px); }
      40% { transform: translate(3px, -2px); }
      60% { transform: translate(-2px, 1px); }
      80% { transform: translate(2px, -1px); }
    }
    .shake {
      animation: shake 0.4s ease-in-out 5;
    }
  </style>
</head>
<body>

  <h2>ðŸŒ‹ Peta Gempa BMKG</h2>
  <div id="scrollGempa">Memuat data gempa...</div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const scrollElem = document.getElementById('scrollGempa');
    let map, marker;

    // ðŸ” Efek teks
    function updateGempa(teks, magnitudo) {
      scrollElem.style.opacity = 0;
      setTimeout(() => {
        scrollElem.textContent = teks;
        scrollElem.className = ''; // reset class
        scrollElem.classList.add('scrolling-text');
        if (magnitudo < 5.0) scrollElem.classList.add('warna-abu-emas');
        else if (magnitudo >= 5.0 && magnitudo < 6.0) scrollElem.classList.add('warna-orange');
        else scrollElem.classList.add('warna-merah-maron');
        scrollElem.style.opacity = 1;

        // ðŸ’¥ Jika gempa besar (â‰¥6 SR), aktifkan efek getar
        if (magnitudo >= 6.0) {
          scrollElem.classList.add('shake');
          document.getElementById('map').classList.add('shake');
          setTimeout(() => {
            scrollElem.classList.remove('shake');
            document.getElementById('map').classList.remove('shake');
          }, 2500);
        }
      }, 800);
    }

    // ðŸŒ Ambil data gempa dari BMKG
    async function fetchGempa() {
      try {
        // gunakan proxy agar lolos CORS (jika buka lokal)
        const res = await fetch('https://data.bmkg.go.id/DataMKG/TEWS/autogempa.json');
        const data = await res.json();
        const g = data.Infogempa.gempa;

        const magnitudo = parseFloat(g.Magnitude);
        const lintang = g.Lintang.replace(' LS','').replace(' LU','') * (g.Lintang.includes('LS') ? -1 : 1);
        const bujur = g.Bujur.replace(' BT','').replace(' BB','') * (g.Bujur.includes('BB') ? -1 : 1);

        const teks = `ðŸŒ‹ ${g.Tanggal} ${g.Jam} | Magnitudo: ${g.Magnitude} SR | Kedalaman: ${g.Kedalaman} | Lokasi: ${g.Wilayah} | Potensi: ${g.Potensi}`;
        updateGempa(teks, magnitudo);

        // ðŸ—ºï¸ Tampilkan di peta
        showOnMap(lintang, bujur, g.Wilayah, g.Magnitude, g.Kedalaman, g.Potensi);

      } catch (e) {
        console.error('Gagal ambil data BMKG:', e);
        updateGempa('âš ï¸ Gagal memuat data gempa dari BMKG.', 0);
      }
    }

    // ðŸ—ºï¸ Tampilkan titik gempa di Leaflet
    function showOnMap(lat, lon, wilayah, magnitudo, kedalaman, potensi) {
      if (!map) {
        map = L.map('map').setView([lat, lon], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 10,
          attribution: 'Â© OpenStreetMap'
        }).addTo(map);
      }

      if (marker) marker.remove();

      const icon = L.circleMarker([lat, lon], {
        radius: Math.min(20, magnitudo * 3),
        fillColor: magnitudo >= 6 ? '#a60000' : (magnitudo >= 5 ? '#e67e00' : '#555'),
        color: '#fff',
        weight: 2,
        fillOpacity: 0.85
      }).addTo(map);

      icon.bindPopup(`<b>${wilayah}</b><br>Magnitudo: ${magnitudo} SR<br>Kedalaman: ${kedalaman}<br>Potensi: ${potensi}`);
      marker = icon;

      map.setView([lat, lon], 6);
    }

    // Jalankan otomatis & perbarui tiap 5 menit
    fetchGempa();
    setInterval(fetchGempa, 5 * 60 * 1000);
  </script>
</body>
</html>
