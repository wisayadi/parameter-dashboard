<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Modern Puzzle Game</title>

<link rel="manifest" id="manifest">
<meta name="theme-color" content="#020617">

<style>
:root{--accent:#22d3ee}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}

  body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
  background:radial-gradient(circle at top,#1e293b,#020617);
  color:white;
  min-height:100vh;
  overflow:hidden;

  /* ‚¨áÔ∏è TAMBAHKAN INI */
  padding-top:env(safe-area-inset-top);
  display:flex;
  justify-content:center;
}

.app{
  width:340px;
  background:rgba(255,255,255,.07);
  backdrop-filter:blur(14px);
  border-radius:18px;
  padding:14px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:13px;
}
.header h2{margin:0;color:var(--accent)}

.board{
  margin-top:10px;
  width:100%;
  aspect-ratio:1/1;
  background:transparent;     /* ‚¨ÖÔ∏è HILANGKAN HITAM */
  border-radius:14px;
  position:relative;
  overflow:visible;           /* ‚¨ÖÔ∏è PENTING */
}

/* === TRUE FULLSCREEN WIN === */
.board.win-mode{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  margin:0;
  border-radius:0;
  background:transparent !important;
  z-index:100000;
} 
  /* === FULL IMAGE WIN OVERLAY === */
.win-image{
  position:fixed;       /* ‚¨ÖÔ∏è BUKAN absolute */
  inset:0;
  background-size:cover;
  background-position:center;
  border-radius:0;
  z-index:100001;
  opacity:0;
  transform:scale(1.02);
  transition:opacity .8s ease, transform 1s ease;
  pointer-events:none;
}
.tile{
  position:absolute;
  border-radius:10px;
  background-size:cover;
  box-shadow:0 5px 12px rgba(0,0,0,.5);
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:700;
  color:white;
  font-size:14px;
  text-shadow:0 1px 4px black;
  transition:transform .12s linear, box-shadow .3s;
}

.tile.correct{
  box-shadow:0 0 14px var(--accent),0 0 30px rgba(34,211,238,.7);
}

.controls{
  display:flex;
  gap:6px;
  margin-top:10px;
}
select,button,label{
  flex:1;
  padding:6px;
  border-radius:10px;
  border:none;
  font-size:11px;
  background:linear-gradient(135deg,#22d3ee,#6366f1);
  color:white;
  text-align:center;
  cursor:pointer;
}

input[type=file]{display:none}

.footer{
  text-align:center;
  font-size:10px;
  opacity:.7;
  margin-top:6px;
}
  
/* === PLAYSTORE PRO SPLASH === */
.cinematic-pro{
  position:absolute;
  inset:0;
  display:grid;
  grid-template-rows:1.1fr auto 1fr;
  place-items:center;
  text-align:center;
  padding:env(safe-area-inset-top) 16px env(safe-area-inset-bottom);
  animation:fadeIn 1.2s ease;
}

/* BRAND GROUP */
.brand{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  transform:translateY(4vh);   /* ‚¨ÖÔ∏è turun natural */
}

/* LOGO */
.studio-logo{
  width:84px;
  height:84px;
  border-radius:20px;
  background:linear-gradient(135deg,#22d3ee,#6366f1);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:44px;
  box-shadow:
    0 15px 40px rgba(0,0,0,.6),
    0 0 40px rgba(99,102,241,.4);
  animation:logoFloat 4s ease-in-out infinite;
}

/* TITLE */
.game-title{
  margin:0;
  font-size:20px;
  font-weight:900;
  letter-spacing:.5px;
  background:linear-gradient(90deg,#22d3ee,#a5b4fc);
  -webkit-background-clip:text;
  color:transparent;
}

/* SUBTITLE */
.game-tagline{
  margin:0;
  font-size:12px;
  opacity:.75;
}

/* TAP BUTTON */
.tap-start{
  height:44px;
  padding:0 32px;
  border-radius:999px;
  border:none;
  font-size:11px;
  font-weight:700;
  letter-spacing:1px;
  color:white;
  background:linear-gradient(135deg,#22d3ee,#6366f1);
  box-shadow:0 14px 32px rgba(0,0,0,.45);
  cursor:pointer;
  animation:pulse 1.8s ease-in-out infinite;
}

/* ANIMATIONS */
@keyframes logoFloat{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
}

@keyframes pulse{
  0%,100%{transform:scale(1)}
  50%{transform:scale(1.04)}
}

@keyframes fadeIn{
  from{opacity:0;transform:scale(.96)}
  to{opacity:1;transform:scale(1)}
}
  #splashAAA{
  position:fixed;
  inset:0;
  z-index:9999;
  background:radial-gradient(circle at top,#1e293b,#020617);
}
   .app{
  width:340px;
  margin-top:clamp(20px, 6vh, 48px);
  position:relative;
  opacity:0;
  pointer-events:none;
  transition:opacity .6s ease;
}
  .tile.hidden{
  opacity:0;
  pointer-events:none;
  transform:scale(.95);
}
  .app.win-hide{
  opacity:0;
  pointer-events:none;
}
  .board.win-mode .tile{
  display:none !important;   /* ‚¨ÖÔ∏è BUKAN opacity */
}
  /* === WIN OVERLAY (HANYA AREA BOARD) === */
#winOverlay{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  border-radius:14px;
  opacity:0;
  pointer-events:none;
  z-index:50;
  transform:scale(1.02);
  transition:opacity .8s ease, transform 1s ease;
}

#winOverlay.show{
  opacity:1;
  transform:scale(1);
}
  .app{
  width:340px;
  margin:auto;
  position:relative;
  top:0;              /* ‚¨ÖÔ∏è TAMBAHAN */
}
  .controls, .header{
  position:relative;
  z-index:100;
}
  /* === BOARD LOCK === */
.board.locked{
  pointer-events:none;
}

/* === WIN IMAGE OVERLAY === */
#winOverlay{
  position:absolute;
  inset:0;
  border-radius:14px;
  background-size:cover;
  background-position:center;
  opacity:0;
  transform:scale(1.03);
  transition:.8s ease;
  z-index:10;
}

#winOverlay.show{
  opacity:1;
  transform:scale(1);
}

/* === WIN PANEL === */
#winPanel{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  align-items:center;
  padding:16px;
  opacity:0;
  pointer-events:none;
  z-index:20;
}

#winPanel.show{
  opacity:1;
  pointer-events:auto;
}

/* TITLE */
.win-title{
  font-size:16px;
  font-weight:900;
  margin-bottom:10px;
  background:linear-gradient(90deg,#22d3ee,#a5b4fc);
  -webkit-background-clip:text;
  color:transparent;
  animation:pop .6s ease;
}

/* ACTION BUTTONS */
.win-actions{
  display:flex;
  gap:10px;
}

.win-actions button{
  padding:4px 8px;
  border-radius:10px;
  border:none;
  font-size:8px;
  font-weight:700;
  background:linear-gradient(135deg,#22d3ee,#6366f1);
  color:white;
  cursor:pointer;
  box-shadow:0 10px 24px rgba(0,0,0,.4);
}

/* POP ANIMATION */
@keyframes pop{
  from{transform:scale(.8);opacity:0}
  to{transform:scale(1);opacity:1}
}
  /* === CONFETTI WIN EFFECT === */
#confetti{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index:200000; /* DI ATAS SEMUA */
}
  /* ================= SETTINGS OVERLAY ================= */
#settingsPage{
  position:absolute;
  inset:0;
  background:rgba(2,6,23,.96);
  backdrop-filter:blur(16px);
  z-index:1000;
  display:none;
  flex-direction:column;
  padding:16px;
  border-radius:18px;
}

#settingsPage.show{
  display:flex;
}

.settings-title{
  font-size:16px;
  font-weight:900;
  margin-bottom:12px;
  text-align:center;
  background:linear-gradient(90deg,#22d3ee,#a5b4fc);
  -webkit-background-clip:text;
  color:transparent;
}

.settings-images{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
  margin-bottom:auto;
}

.settings-images button{
  aspect-ratio:1/1;
  border-radius:12px;
  background-size:cover;
  background-position:center;
  border:2px solid transparent;
}

.settings-images button:hover{
  border-color:var(--accent);
}

.settings-footer button{
  width:100%;
  padding:10px;
  border-radius:12px;
  font-weight:700;
}
  
  /* === SETTINGS EXIT BUTTON (PROPORTIONAL) === */
.settings-exit{
  width:66%;                 /* ‚¨ÖÔ∏è 2/3 dari tombol Back */
  height:46px;               /* ‚¨ÖÔ∏è tinggi normal */
  margin:18px auto 8px;      /* ‚¨ÖÔ∏è center horizontal */
  display:flex;
  align-items:center;
  justify-content:center;

  border-radius:14px;
  border:none;
  font-size:13px;
  font-weight:700;
  letter-spacing:.6px;
  color:white;

  background:linear-gradient(135deg,#ef4444,#f97316);
  box-shadow:
    0 12px 26px rgba(0,0,0,.45),
    0 0 18px rgba(239,68,68,.35);

  cursor:pointer;
  transition:.25s ease;
}

.settings-exit:active{
  transform:scale(.96);
  box-shadow:0 8px 18px rgba(0,0,0,.4);
}
  .settings-exit{
  flex:0 0 auto !important;   /* üî• KUNCI UTAMA */
  align-self:center;          /* center horizontal */
  width:66%;
  height:46px;
  margin:14px 0 10px;

  display:flex;
  align-items:center;
  justify-content:center;

  border-radius:999px;
  border:none;
  font-size:13px;
  font-weight:700;
  letter-spacing:.6px;
  color:white;

  background:linear-gradient(135deg,#ef4444,#f97316);
  box-shadow:
    0 10px 24px rgba(0,0,0,.4),
    0 0 16px rgba(239,68,68,.35);

  cursor:pointer;
  transition:.25s ease;
}
  /* =====================================================
   PRO INTERACTIVE BUTTON EFFECT (GLOBAL)
===================================================== */

/* Base interactive */
button, label, select {
  position: relative;
  overflow: hidden;
  transition:
    background .25s ease,
    transform .12s ease,
    box-shadow .25s ease,
    filter .25s ease;
}

/* HOVER (desktop) */
@media (hover:hover){
  button:hover,
  label:hover,
  select:hover{
    filter:brightness(1.15) saturate(1.2);
    box-shadow:
      0 8px 22px rgba(34,211,238,.45),
      0 0 16px rgba(99,102,241,.35);
    transform:translateY(-1px) scale(1.03);
  }
}

/* ACTIVE / TAP */
button:active,
label:active,
select:active{
  transform:scale(.96);
  filter:brightness(.9) saturate(1.1);
  box-shadow:
    0 4px 12px rgba(0,0,0,.6) inset,
    0 2px 6px rgba(0,0,0,.4);
}

/* RIPPLE LIGHT EFFECT */
button::after,
label::after{
  content:"";
  position:absolute;
  inset:0;
  background:radial-gradient(circle at center,
    rgba(255,255,255,.35),
    transparent 65%);
  opacity:0;
  transition:.35s ease;
  pointer-events:none;
}

button:active::after,
label:active::after{
  opacity:1;
}

/* DISABLE HOVER JITTER ON MOBILE */
@media (hover:none){
  button:hover,
  label:hover,
  select:hover{
    transform:none;
    box-shadow:none;
    filter:none;
  }
}
  .controls button:active{
  background:linear-gradient(135deg,#0ea5e9,#6366f1);
}
  .tap-start:active{
  background:linear-gradient(135deg,#38bdf8,#818cf8);
  box-shadow:
    0 6px 18px rgba(0,0,0,.6) inset,
    0 0 22px rgba(56,189,248,.6);
}
  /* =====================================================
   TRUE HOVER + ACTIVE COLOR CHANGE (PRO FIX)
===================================================== */

/* HOVER */
@media (hover:hover){
  button:hover,
  label:hover,
  select:hover{
    background:
      linear-gradient(135deg,#38bdf8,#818cf8) !important;
    box-shadow:
      0 10px 26px rgba(56,189,248,.6),
      0 0 18px rgba(129,140,248,.45);
    transform:translateY(-1px) scale(1.04);
  }
}

/* ACTIVE (TAP / CLICK) */
button:active,
label:active,
select:active{
  background:
    linear-gradient(135deg,#0ea5e9,#4f46e5) !important;
  box-shadow:
    0 6px 14px rgba(0,0,0,.6) inset,
    0 0 20px rgba(79,70,229,.6);
  transform:scale(.94);
}

/* HOVER + ACTIVE BERSAMAAN (INI YANG HILANG SEBELUMNYA) */
@media (hover:hover){
  button:hover:active,
  label:hover:active,
  select:hover:active{
    background:
      linear-gradient(135deg,#0284c7,#4338ca) !important;
    filter:brightness(1.15);
    box-shadow:
      0 4px 10px rgba(0,0,0,.7) inset,
      0 0 24px rgba(67,56,202,.75);
  }
}
  .tap-start:active{
  background:
    linear-gradient(135deg,#22d3ee,#6366f1) !important;
  box-shadow:
    0 8px 22px rgba(0,0,0,.6) inset,
    0 0 32px rgba(34,211,238,.8);
  transform:scale(.92);
}
  /* ================= CLICK FLASH YELLOW (GLOBAL) ================= */
.flash-yellow{
  background:linear-gradient(135deg,#fde047,#facc15) !important;
  box-shadow:
    0 0 0 2px rgba(255,255,255,.25) inset,
    0 0 18px rgba(250,204,21,.9),
    0 8px 18px rgba(0,0,0,.5);
  filter:brightness(1.15) saturate(1.2);
  transform:scale(.96);
}
    </style>
</head>

<body>
 <div id="splashAAA">
  <canvas id="particles"></canvas>

  <div class="cinematic-pro">
    <div class="brand">
      <div class="studio-logo">üß©</div>
      <h1 class="game-title">Modern Puzzle Game</h1>
      <p class="game-tagline">Think Smart ‚Ä¢ Play Smooth</p>
    </div>

    <!-- <button class="tap-start" onclick="startGame()"> -->
    <!-- <button class="tap-start" onclick="playIntroSound(); startGame();">
      TAP TO START-->
    <button class="tap-start" onclick="handleStart()">
  TAP TO START
    </button>
  </div>
</div>
  
<div class="app">
  <div class="header">
    <h2>Puzzle</h2>
    <div>Moves: <span id="moves">0</span></div>
   </div>
  
  <canvas id="confetti"></canvas>

 <div class="controls">
  <select id="level">
    <option value="3">3√ó3</option>
    <option value="4" selected>4√ó4</option>
    <option value="5">5√ó5</option>
  </select>

  <label for="imgInput">üì∑</label>
  <input type="file" id="imgInput" accept="image/*">

  <button onclick="shuffle()">üîÄ</button>
  <button onclick="toggleNumber()">üî¢</button>

  <!-- ‚úÖ FULLSCREEN TETAP -->
  <button onclick="toggleFullscreen()">‚õ∂</button>

  <!-- üÜï SETTINGS -->
  <button onclick="openSettings()">‚öôÔ∏è</button>
</div>
  
  <div class="board" id="board">
  <div id="winOverlay"></div>

     <div id="winPanel">
    <div class="win-title">üéâ PUZZLE SOLVED!</div>
    <div class="win-actions">
      <button onclick="replay()">üîÅ Replay</button>
      <!--  <button onclick="shuffle()">‚û°Ô∏è Next</button> -->
    </div>
  </div>
</div> 
  <!-- üéµ SPLASH AUDIO -->
  <audio id="introSound" loop preload="auto">
  <source src="https://actions.google.com/sounds/v1/ambiences/wind_chimes.ogg" type="audio/ogg">
</audio>
<audio id="tapSound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" type="audio/ogg">
</audio>
  
  <div class="footer">High Score: <span id="high">-</span></div>
</div>
  <!-- ================= SETTINGS PAGE ================= -->
<div id="settingsPage">
  <div class="settings-title">‚öôÔ∏è Settings</div>

  <div class="settings-images">
    <button style="background-image:url('https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=800')" onclick="setDefaultImage(0)"></button>

    <button style="background-image:url('https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=800')" onclick="setDefaultImage(1)"></button>

    <button style="background-image:url('https://images.unsplash.com/photo-1523413651479-597eb2da0ad6?w=800')" onclick="setDefaultImage(2)"></button>
  </div>
  
  <audio id="beepClick">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

  <button class="settings-exit" onclick="goDashboard()">Exit</button>

  <div class="settings-footer">
    <button onclick="closeSettings()">‚¨ÖÔ∏è Back</button>
  </div>
</div>
  
<script>
  
/* ===== PARTICLE EFFECT ===== */
const canvas = document.getElementById("particles");
const ctx = canvas.getContext("2d");

let w,h,particles=[];
function resize(){
  w = canvas.width = window.innerWidth;
  h = canvas.height = window.innerHeight;
}
window.addEventListener("resize",resize);
resize();

for(let i=0;i<60;i++){
  particles.push({
    x:Math.random()*w,
    y:Math.random()*h,
    r:Math.random()*2+1,
    vx:(Math.random()-.5)*.3,
    vy:(Math.random()-.5)*.3,
    a:Math.random()
  });
}

function animate(){
  ctx.clearRect(0,0,w,h);
  particles.forEach(p=>{
    p.x+=p.vx;
    p.y+=p.vy;
    if(p.x<0)p.x=w;
    if(p.y<0)p.y=h;
    if(p.x>w)p.x=0;
    if(p.y>h)p.y=0;
    ctx.fillStyle=`rgba(99,102,241,${p.a})`;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(animate);
}
animate();

/* ===== START GAME ===== */
  function startGame(){
  const splash = document.getElementById("splashAAA");
  const app = document.querySelector(".app");

  // üé¨ cinematic transition
  splash.style.opacity = 0;

  setTimeout(()=>{
    splash.remove();
    app.style.opacity = 1;
    app.style.pointerEvents = "auto";

    // üéµ FADE INTRO SETELAH SPLASH BENAR-BENAR HILANG
    const fade = setInterval(()=>{
      if(introSound.volume > 0.05){
        introSound.volume -= 0.03;
      }else{
        introSound.pause();
        clearInterval(fade);
      }
    },60);

  },800);
}

/* ================= CORE ================= */
let SIZE=4, tiles=[], moves=0;
/*let imageSrc="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=600";*/
let imageSrc="https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=800";
let numberOn=true;

const board=document.getElementById("board");
const movesEl=document.getElementById("moves");
const highEl=document.getElementById("high");

const audio=new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
const winAudio=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

function vibrate(){navigator.vibrate&&navigator.vibrate(15);}

/* ================= FULLSCREEN ================= */
function toggleFullscreen(){
  const beepClick = document.getElementById("beepClick");
  beepClick.play();
  if(!document.fullscreenElement){
    document.documentElement.requestFullscreen();
  }else{
    document.exitFullscreen();
  }
}

/* ================= TOGGLE ANGKA ================= */
function toggleNumber(){  
  const beepClick = document.getElementById("beepClick");
  beepClick.play();
  numberOn=!numberOn;
  document.querySelectorAll(".tile").forEach(t=>{
    t.textContent = numberOn ? t.dataset.id : "";
  });
}

/* ================= IMAGE ================= */
imgInput.onchange=e=>{
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=()=>{imageSrc=r.result;init()};
  r.readAsDataURL(f);
};

/* ================= INIT ================= */
function init(){
  const beepClick = document.getElementById("beepClick");
  beepClick.play();

  SIZE=parseInt(level.value);
  tiles=[...Array(SIZE*SIZE-1).keys()].map(n=>n+1).concat(0);
  moves=0;movesEl.textContent=0;
  /*board.innerHTML="";*/
  board.querySelectorAll(".tile").forEach(t => t.remove());

  const s=100/SIZE;

  for(let i=1;i<SIZE*SIZE;i++){
    const t=document.createElement("div");
    t.className="tile";
    t.dataset.id=i;
    t.textContent=numberOn?i:"";
    t.style.width=t.style.height=s+"%";
    t.style.backgroundImage=`url(${imageSrc})`;
    t.style.backgroundSize=`${SIZE}00% ${SIZE}00%`;
    t.style.backgroundPosition=
      `${-((i-1)%SIZE)*100}% ${-Math.floor((i-1)/SIZE)*100}%`;
    t.onclick=()=>move(tiles.indexOf(i));
    board.appendChild(t);
  }
  render();updateHigh();
}

/* ================= RENDER ================= */
function render(){
  tiles.forEach((n,i)=>{
    if(!n) return;
    const t=document.querySelector(`[data-id="${n}"]`);
    t.style.transform=
      `translate(${(i%SIZE)*100}%,${Math.floor(i/SIZE)*100}%)`;
    t.classList.toggle("correct",n===i+1);
  });
}

/* ================= MOVE ================= */
function move(i){
  const e=tiles.indexOf(0);
  const x=i%SIZE,y=i/SIZE|0,ex=e%SIZE,ey=e/SIZE|0;
  if(Math.abs(x-ex)+Math.abs(y-ey)!==1) return;

  [tiles[i],tiles[e]]=[tiles[e],tiles[i]];
  moves++;movesEl.textContent=moves;
  audio.currentTime=0;audio.play().catch(()=>{});
  vibrate();render();checkWin();
}

/* ================= SHUFFLE ================= */
  function shuffle(){
  const beepClick = document.getElementById("beepClick");
  beepClick.play();
  numberOn = false;
  document.querySelectorAll(".tile").forEach(t => t.textContent = "");

  // RESET ke posisi solved
  tiles = [...Array(SIZE * SIZE - 1).keys()].map(n => n + 1).concat(0);

  let empty = tiles.length - 1;
  let last = -1;

  // lakukan gerakan valid acak
  for(let i = 0; i < SIZE * SIZE * 20; i++){
    const x = empty % SIZE;
    const y = Math.floor(empty / SIZE);

    const moves = [];
    if(x > 0) moves.push(empty - 1);
    if(x < SIZE - 1) moves.push(empty + 1);
    if(y > 0) moves.push(empty - SIZE);
    if(y < SIZE - 1) moves.push(empty + SIZE);

    // hindari bolak-balik
    const valid = moves.filter(m => m !== last);
    const next = valid[Math.random() * valid.length | 0];

    last = empty;
    [tiles[empty], tiles[next]] = [tiles[next], tiles[empty]];
    empty = next;
  }

  moves = 0;
  movesEl.textContent = 0;
  render();
}
  
/* ================= WIN ================= */
  function checkWin(){
  for(let i=0;i<SIZE*SIZE-1;i++) if(tiles[i]!==i+1) return;

  winAudio.play().catch(()=>{});

  const k=`high_${SIZE}`;
  const b=localStorage.getItem(k);
  if(!b||moves<b) localStorage.setItem(k,moves);
  updateHigh();

  /*showFullImage(); // ‚¨ÖÔ∏è TAMBAHAN UTAMA*/
    showFullImage();
launchConfetti(); // üéâ CONFETTI MENANG
}
  
  function showFullImage(){
  const overlay = document.getElementById("winOverlay");
  const panel   = document.getElementById("winPanel");

  // kunci board
  board.classList.add("locked");

  // pasang gambar utuh
  overlay.style.backgroundImage = `url(${imageSrc})`;

  // sembunyikan tile
  document.querySelectorAll(".tile").forEach(t=>{
    t.style.opacity = 0;
    t.style.pointerEvents = "none";
  });

  // tampilkan overlay & panel
  requestAnimationFrame(()=>{
    overlay.classList.add("show");
    panel.classList.add("show");
  });

  navigator.vibrate && navigator.vibrate([80,120,80]);
}
  function replay(){
  const overlay = document.getElementById("winOverlay");
  const panel   = document.getElementById("winPanel");

  overlay.classList.remove("show");
  panel.classList.remove("show");

  board.classList.remove("locked");

  document.querySelectorAll(".tile").forEach(t=>{
    t.style.opacity = 1;
    t.style.pointerEvents = "auto";
  });

  shuffle();
}
  function goDashboard() {
  const beepClick = document.getElementById("beepClick");
  beepClick.play();
  window.ignoreBack = true;
  setTimeout(() => {
    window.location.href = "https://wisayadi.github.io/parameter-dashboard/cardipa.html";
  }, 200);
}
  function playBeep() {
  const beep = document.getElementById("beepClick");
  if (beep) {
    beep.currentTime = 0;
    beep.play().catch(()=>{}); // cegah error berhenti script
  }
  setTimeout(() => {
    location.share();
  }, 250);
}

function updateHigh(){
  highEl.textContent=localStorage.getItem(`high_${SIZE}`)||"-";
}

level.onchange=init;
init();

/* ================= PWA ================= */
const manifest={
  name:"Modern Puzzle Game",
  short_name:"Puzzle",
  start_url:".",
  display:"fullscreen",
  background_color:"#020617",
  theme_color:"#020617",
  icons:[{
    src:"https://cdn-icons-png.flaticon.com/512/751/751381.png",
    sizes:"512x512",
    type:"image/png"
  }]
};
document.getElementById("manifest").href=
  URL.createObjectURL(new Blob([JSON.stringify(manifest)],{type:"application/json"}));

if("serviceWorker" in navigator){
  const sw=`self.addEventListener("fetch",e=>{
    e.respondWith(fetch(e.request).catch(()=>caches.match(e.request)))
  })`;
  navigator.serviceWorker.register(
    URL.createObjectURL(new Blob([sw],{type:"text/javascript"}))
  );
}
  /* ================= CONFETTI EFFECT ================= */
const confettiCanvas = document.getElementById("confetti");
const confettiCtx = confettiCanvas.getContext("2d");

let cw, ch, confettis = [], confettiActive = false;

function resizeConfetti(){
  cw = confettiCanvas.width = window.innerWidth;
  ch = confettiCanvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeConfetti);
resizeConfetti();

function launchConfetti(){
  confettis = [];
  confettiActive = true;

  for(let i=0;i<120;i++){
    confettis.push({
      x:Math.random()*cw,
      y:Math.random()*-ch,
      r:Math.random()*6+4,
      c:`hsl(${Math.random()*360},90%,60%)`,
      vy:Math.random()*4+3,
      vx:(Math.random()-.5)*2,
      rot:Math.random()*360,
      vr:(Math.random()-.5)*10
    });
  }

  animateConfetti();
}

function animateConfetti(){
  if(!confettiActive) return;

  confettiCtx.clearRect(0,0,cw,ch);

  confettis.forEach(p=>{
    p.x+=p.vx;
    p.y+=p.vy;
    p.rot+=p.vr;

    confettiCtx.save();
    confettiCtx.translate(p.x,p.y);
    confettiCtx.rotate(p.rot*Math.PI/180);
    confettiCtx.fillStyle=p.c;
    confettiCtx.fillRect(-p.r/2,-p.r/2,p.r,p.r);
    confettiCtx.restore();
  });

  confettis = confettis.filter(p=>p.y < ch+20);

  if(confettis.length){
    requestAnimationFrame(animateConfetti);
  }else{
    confettiActive=false;
    confettiCtx.clearRect(0,0,cw,ch);
  }
}
  /* ===== SPLASH AUDIO CONTROL ===== */
const introSound = document.getElementById("introSound");
const tapSound   = document.getElementById("tapSound");

// aktifkan audio saat interaksi pertama (wajib mobile)

let introStarted = false;

function handleStart(){
  // üîä START INTRO (PASTI BUNYI)
  if(!introStarted){
    introStarted = true;
    introSound.volume = 0.4;
    introSound.currentTime = 0;
    introSound.play().catch(()=>{});
  }

  // üîä TAP SOUND
  tapSound.currentTime = 0;
  tapSound.play().catch(()=>{});

  // ‚è≥ TUNGGU SEBENTAR BIAR INTRO TERDENGAR
  setTimeout(startGame, 1200);
} 
  
  /* ================= SETTINGS LOGIC ================= */
const defaultImages=[
  "https://images.unsplash.com/photo-1501594907352-04cda38ebc29?w=800",
  "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=800",
  "https://images.unsplash.com/photo-1523413651479-597eb2da0ad6?w=800"
];

function openSettings(){
  const beepClick = document.getElementById("beepClick");
  beepClick.play();
  document.getElementById("settingsPage").classList.add("show");
}

function closeSettings(){
  const beepClick = document.getElementById("beepClick");
  beepClick.play();
  document.getElementById("settingsPage").classList.remove("show");
}

function setDefaultImage(i){
  imageSrc = defaultImages[i];
  closeSettings();
  init();
}
  
/* ========= GLOBAL YELLOW CLICK EFFECT ========= */
document.addEventListener("click", e=>{
  const el = e.target.closest("button, label, select");
  if(!el) return;

  el.classList.add("flash-yellow");

  setTimeout(()=>{
    el.classList.remove("flash-yellow");
  },500); // ‚¨ÖÔ∏è durasi kilat (bisa 80‚Äì150)
});

  </script>
</body>
</html>
